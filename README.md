# BoardGame Analyzer

BoardGameGeek (BGG) APIを使用してボードゲーム情報を検索、分析、保存するためのStreamlitアプリケーションです。新たに類似性検索機能を追加し、ゲーム間の関連性を分析できるようになりました。

**デモ:** [Streamlit Community Cloud](https://boardgameanalyzer-gsmlbaspmgvf3arxttip4f.streamlit.app/)（一部文字化けがございます）

## 目次

- [主な機能](#主な機能)
- [インストール方法](#インストール方法)
- [アプリの使い方](#アプリの使い方)
  - [基本機能](#基本機能)
  - [類似性検索機能](#類似性検索機能)
- [技術的詳細](#技術的詳細)
  - [学習曲線分析システム](#学習曲線分析システム)
  - [複雑さデータのカスタマイズ](#複雑さデータのカスタマイズ)
  - [戦略的価値と相互作用の分析](#戦略的価値と相互作用の分析)
- [プロジェクト構成](#プロジェクト構成)
- [注意事項](#注意事項)
- [謝辞](#謝辞)

## 主な機能

- **検索と情報取得**
  - ゲーム名での検索: 名前を使ってBGGからボードゲームを検索
  - ゲームIDによる詳細情報取得: ゲームIDを使用して詳細なゲーム情報を取得
  - 保存済みゲームの選択: 保存したゲームデータをドロップダウンから簡単に選択

- **データ分析と保存**
  - データ分析: ゲームの複雑さ、学習曲線、リプレイ性などを自動分析
  - YAMLデータ保存: 取得したゲーム情報をYAML形式でローカルに保存
  - データ比較機能: 既存データと新規取得データの自動比較

- **ゲーム特性分析**
  - ラーニングカーブ分析: ゲームの学習しやすさやマスターに必要な時間の推定
  - カテゴリ分析: ゲームカテゴリに基づく複雑さの評価
  - ランキング分析: BGGランキング種別と順位に基づく評価
  - 戦略深度評価: 意思決定の質と重みに基づく戦略性の分析
  - プレイヤー相互作用分析: ゲームにおけるプレイヤー間の相互作用の評価

- **比較と類似性分析**
  - ゲーム比較機能: 複数のゲームを選択し、レーダーチャートと数値比較で分析
  - 類似性検索機能: 埋め込みデータを使用して類似ゲームを検索・分析

## インストール方法

1. このリポジトリをクローンまたはダウンロードします

```bash
git clone https://github.com/yourusername/boardgame-analyzer.git
cd boardgame-analyzer
```

2. 必要なライブラリをインストールします

```bash
pip install -r requirements.txt
```

または個別にインストールする場合:

```bash
pip install streamlit pandas requests pyyaml deepdiff plotly
```

類似性検索機能を使用する場合は、追加で以下のライブラリが必要です:

```bash
pip install voyageai scikit-learn tqdm python-dotenv
```

3. アプリケーションを実行します

```bash
streamlit run app.py
```

ブラウザで自動的に開かれるアプリケーションにアクセスします（通常は <http://localhost:8501>）

## アプリの使い方

### 基本機能

#### ゲーム名で検索
1. サイドバーから「ゲーム名で検索」を選択
2. 検索したいゲーム名を入力
3. 完全一致検索を行いたい場合はチェックボックスをオン
4. 「検索」ボタンをクリック

#### ゲームIDで詳細情報を取得
1. サイドバーから「ゲームIDで詳細情報を取得」を選択
2. 手動入力または保存済みYAMLファイルから選択
3. 「詳細情報を取得」ボタンをクリック
4. 詳細情報が表示され、以下の情報を確認できます：
   - 基本情報（ゲーム名、発行年、平均評価）
   - プレイ人数情報（最適人数、対応人数）
   - 推奨年齢・プレイ時間
   - ゲームの複雑さと学習曲線分析
   - ゲーム説明文
   - メカニクス、カテゴリ、ランキング、デザイナー、パブリッシャー情報

#### YAMLでデータを保存
1. サイドバーから「YAMLでデータを保存」を選択
2. 保存したいゲームをドロップダウンリストから選択
3. ファイル名を入力（空白の場合は自動生成）
4. 「選択したゲームデータをYAMLに保存」ボタンをクリック

#### ゲーム比較機能
1. サイドバーから「ゲーム比較」を選択
2. 比較したいゲームを複数選択（最大6つまで）
3. 選択したゲームの特性がレーダーチャートで視覚化され、数値比較テーブルで詳細な数値を確認できます

### 類似性検索機能

1. サイドバーから「類似性検索」を選択
2. 検索の設定を調整（表示する類似ゲーム数、類似度閾値）
3. カテゴリやメカニクスでフィルタリングするには「検索フィルターを設定」を展開
4. フィルタリング結果から検索の基準となるゲームを選択
5. 「類似ゲームを検索」ボタンをクリック
6. 結果は以下のタブで表示されます：
   - 類似ゲーム一覧：類似度スコアと類似の理由を含むゲーム情報
   - 類似度ヒートマップ：ゲーム間の類似関係を視覚化
   - データ分析：最も類似度が高いゲームのリスト、カテゴリとメカニクスの分布分析

## 技術的詳細

### 学習曲線分析システム

このアプリは独自のアルゴリズムを使用してボードゲームの学習曲線を分析します：

#### 分析に使用する要素
- メカニクスの複雑さと数
- BGGでの重さ評価（Weight）
- カテゴリの複雑さ
- ランキング情報
- リプレイ性
- メカニクスの戦略的価値
- プレイヤー相互作用値
- プレイ時間

#### 分析結果の指標
- 初期学習の障壁（1〜5）
- 戦略の深さ（1〜5）
- 意思決定ポイント（1〜5）
- プレイヤー相互作用（1〜5）
- ルールの複雑さ（1〜5）
- カテゴリに基づく複雑さ（1〜5）
- ランキングに基づく複雑さ（1〜5）
- 学習曲線タイプ
- リプレイ性（1〜5）
- マスター時間
- 対象プレイヤータイプ

### 複雑さデータのカスタマイズ

本アプリは、以下の3つのYAMLファイルを使用して複雑さの評価を行います：

- `mechanics_data.yaml`: メカニクス（ゲームの仕組み）ごとの複雑さ、戦略的価値、相互作用値
- `categories_data.yaml`: カテゴリ（ゲームのテーマや種類）ごとの複雑さ、戦略的価値、相互作用値
- `rank_complexity.yaml`: ランキング種別ごとの複雑さ、戦略的価値、相互作用値

これらのファイルは手動で編集できるため、実際のゲーム体験に基づいてカスタマイズすることで、より正確な分析が可能になります。初回起動時に基本データが自動生成され、新しいメカニクスやカテゴリが見つかると自動的に追加されます。

#### 編集時の注意点

- すべてのYAMLファイルは必ず UTF-8 エンコーディングで保存してください
- 他のエンコーディング（Shift-JISなど）で保存すると読み込みエラーが発生します
- 数値は1.0～5.0の範囲内にしてください（小数点第一位まで）

### 戦略的価値と相互作用の分析

各メカニクスとカテゴリには以下の値が定義されています：

- 複雑さ (complexity): ルールや概念の複雑さ（1.0～5.0）
- 戦略的価値 (strategic_value): 戦略的深さへの貢献度（1.0～5.0）
- 相互作用値 (interaction_value): プレイヤー間の相互作用の程度（1.0～5.0）

例えば、mechanics_data.yamlでは以下のように定義されています：

```yaml
Engine Building:
  complexity: 4.7
  strategic_value: 5.0
  interaction_value: 2.0
  description: 戦略的に非常に深いが、相互作用は比較的少ない
```

これらの値は、ゲームの戦略深度と相互作用の複雑さをより精密に計算するために使用されます。

## プロジェクト構成

```
boardgame-analyzer/
├── app.py                         # メインアプリケーション
├── requirements.txt               # 必要なパッケージのリスト
├── generate_embedding_model.py    # 埋め込みモデル生成スクリプト
├── config/                        # 設定ファイル
│   ├── mechanics_data.yaml        # メカニクスの複雑さデータ
│   ├── categories_data.yaml       # カテゴリの複雑さデータ
│   └── rank_complexity.yaml       # ランキング種別の複雑さデータ
├── game_data/                     # 保存されたゲームデータ
├── src/                           # ソースコード
│   ├── api/                       # API関連
│   ├── data/                      # データ処理
│   └── analysis/                  # 分析関連
└── ui/                            # UI関連
    ├── ui_components.py           # UIコンポーネント関数
    └── pages/                     # ページコンポーネント
```

## 注意事項

- ゲーム名に特殊文字（:;など）が含まれていると、ファイル保存に失敗する場合があります
- このツールは学習曲線分析アルゴリズムが主観的要素を含み、絶対的な評価ではありません
- 類似性検索機能を使用するには、事前に埋め込みデータファイル（game_embeddings.pkl）が必要です
- 自分で埋め込みデータを生成する場合は、Voyage AIのユーザー登録と支払い設定が必要です

## 謝辞

このアプリケーションはBoardGameGeek APIを使用しています。BoardGameGeekに感謝します。
また、類似性検索機能の埋め込みデータの作成にはVoyage AIのエンベディングAPIを使用しています。
