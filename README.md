# BoardGame Analyzer

BoardGameGeek (BGG) APIを使用してボードゲーム情報を検索、分析、保存するためのStreamlitアプリケーションです。

## 概要

このアプリケーションは、BoardGameGeek APIを通じてボードゲームのデータを取得し、ゲームの複雑さ、学習曲線、メカニクスなどを分析するためのツールです。日本語UIで設計されており、ボードゲーム愛好家やボードゲームの情報を整理したい方に最適です。

デモはStreamlit Community Cloudで確認できます。（YAMLデータ保存はできますが、ローカルPCには保存されません）
<https://boardgameanalyzer-gsmlbaspmgvf3arxttip4f.streamlit.app/>

## 主な機能

- ゲーム名での検索: 名前を使ってBGGからボードゲームを検索
- ゲームIDによる詳細情報取得: ゲームIDを使用して詳細なゲーム情報を取得
- 保存済みゲームの選択: 保存したゲームデータをドロップダウンから簡単に選択
- データ分析: ゲームの複雑さ、学習曲線、リプレイ性などを自動分析
- YAMLデータ保存: 取得したゲーム情報をYAML形式でローカルに保存
- 日本語名対応: 日本語名があるゲームは日本語表示に対応
- ラーニングカーブ分析: ゲームの学習しやすさやマスターに必要な時間の推定
- データ比較機能: 既存データと新規取得データの自動比較
- カテゴリ分析: ゲームカテゴリに基づく複雑さの評価
- ランキング分析: BGGランキング種別と順位に基づく評価

## インストール方法

1. このリポジトリをクローンまたはダウンロードします

```bash
git clone https://github.com/yourusername/boardgame-analyzer.git
cd boardgame-analyzer
```

2. 必要なライブラリをインストールします

```bash
pip install -r requirements.txt
```

または個別にインストールする場合:

```bash
pip install streamlit pandas requests pyyaml deepdiff
```

## 使用方法

ターミナルでアプリケーションを実行します

```bash
streamlit run app.py
```

ブラウザで自動的に開かれるアプリケーションにアクセスします（通常は <http://localhost:8501）>

## アプリの使い方

### ゲーム名で検索

1. サイドバーから「ゲーム名で検索」を選択
2. 検索したいゲーム名を入力
3. 完全一致検索を行いたい場合はチェックボックスをオン
4. 「検索」ボタンをクリック
5. 検索結果が表示され、各ゲームのゲームID、ゲーム名、発行年が表示されます

### ゲームIDで詳細情報を取得

1. サイドバーから「ゲームIDで詳細情報を取得」を選択
2. 手動入力または保存済みYAMLファイルから選択
3. 「詳細情報を取得」ボタンをクリック
4. 詳細情報が表示され、以下の情報を確認できます：
   - 基本情報（ゲーム名、発行年、平均評価）
   - プレイ人数情報（最適人数、対応人数）
   - 推奨年齢・プレイ時間
   - ゲームの複雑さ
   - ラーニングカーブ分析
   - ゲーム説明文
   - メカニクス、カテゴリ、ランキング、デザイナー、パブリッシャー情報

### YAMLでデータを保存

1. サイドバーから「YAMLでデータを保存」を選択
2. 保存したいゲームをドロップダウンリストから選択
3. ファイル名を入力（空白の場合は自動生成）
4. 「選択したゲームデータをYAMLに保存」ボタンをクリック
5. 保存が成功すると確認メッセージが表示されます

### データ比較機能

保存済みのゲームデータと新しく取得したデータを自動的に比較し、変更があった場合は詳細な変更内容を表示します。この機能により、時間経過によるゲームデータの変化（評価の更新、メカニクスの追加/削除など）を追跡できます。

## 学習曲線分析システム

このアプリは独自のアルゴリズムを使用してボードゲームの学習曲線を分析します。以下の要素を考慮して分析が行われます：

### 分析に使用する要素

- メカニクスの複雑さと数: 各ゲームメカニクスに複雑さスコアを割り当て、総合的な複雑さを計算
- BGGでの重さ評価（Weight）: コミュニティによって評価された複雑さの指標
- カテゴリの複雑さ: 各ゲームカテゴリに割り当てられた複雑さに基づく評価
- ランキング情報: BGGでの種別ごとのランキングと順位に基づく評価
- ランキング種別の複雑さ: 各ランキング種別（戦略ゲーム、ファミリーゲームなど）の特性に基づく複雑さ
- リプレイ性: ゲームの再プレイ価値

### 分析結果の指標

分析結果には以下の指標が含まれます：

- 初期学習の障壁（1〜5）: ゲームを始めるための難易度
- 戦略の深さ（1〜5）: ゲームの戦略的側面の複雑さと深さ
- 意思決定ポイント（1〜5）: ゲーム中の意思決定の複雑さと多様性
- プレイヤー相互作用（1〜5）: プレイヤー間の相互作用の複雑さ
- ルールの複雑さ（1〜5）: ルールの難解さの評価
- カテゴリに基づく複雑さ（1〜5）: ゲームカテゴリから算出された複雑さ
- ランキングに基づく複雑さ（1〜5）: BGGランキングから算出された複雑さ
- 学習曲線タイプ: 学習難易度の推移パターン（緩やか、中程度、急など）
- リプレイ性（1〜5）: ゲームを繰り返し遊ぶ価値と多様性
- マスター時間: ゲームをマスターするのにかかる時間の推定（短い、中程度、長いなど）
- 対象プレイヤータイプ: どのようなプレイヤーに適しているか（初心者、熟練者など）

## 複雑さデータのカスタマイズ

本アプリは、以下の3つのYAMLファイルを使用して複雑さの評価を行います：

- mechanics_data.yaml: メカニクス（ゲームの仕組み）ごとの複雑さ
- categories_data.yaml: カテゴリ（ゲームのテーマや種類）ごとの複雑さ
- rank_complexity.yaml: ランキング種別ごとの複雑さ

これらのファイルは手動で編集できるため、実際のゲーム体験に基づいてカスタマイズすることで、より正確な分析が可能になります。初回起動時に基本データが自動生成され、新しいメカニクスやカテゴリが見つかると自動的に追加されます。

### 複雑さデータファイルの使い方と注意点

本アプリは3つのYAMLファイル（mechanics_data.yaml、categories_data.yaml、rank_complexity.yaml）を使用して、ボードゲームの複雑さを評価します。これらのファイルを適切に管理することで、より正確な分析結果を得ることができます。

#### ファイルの役割

- mechanics_data.yaml: ゲームのメカニクス（ルールの仕組み）ごとの複雑さを定義
- categories_data.yaml: ゲームのカテゴリ（テーマや種類）ごとの複雑さを定義
- rank_complexity.yaml: BGGのランキング種別（戦略ゲーム、ファミリーゲームなど）ごとの複雑さを定義

#### 編集時の注意点

**エンコーディング:**

- すべてのYAMLファイルは必ず UTF-8 エンコーディングで保存してください
- 他のエンコーディング（Shift-JISなど）で保存すると読み込みエラーが発生します

**コメント:**

- コメントは英語で記述することを推奨します（# Strategy Games (Complex)）
- 日本語コメントを使用する場合は、エディタで明示的にUTF-8で保存してください

**書式:**

- 各行は メカニクス名: 数値 # コメント の形式で記述します
- 数値は1.0～5.0の範囲内にしてください（小数点第一位まで）

**複雑さの基準:**

- 1.0～1.5: 非常に簡単（子供向け、サイコロを振って進むなど）
- 1.6～2.0: 簡単（ビンゴ、記憶、レースなど）
- 2.1～2.5: やや簡単（運試し、トラック移動など）
- 2.6～3.0: 中程度（協力ゲーム、エリア移動など）
- 3.1～3.5: やや複雑（アクションポイント、交渉など）
- 3.6～4.0: 複雑（エリアコントロール、デッキ構築など）
- 4.1～5.0: 非常に複雑（エンジン構築、ワーカープレイスメントなど）

#### ファイルの自動生成と更新

- アプリ初回起動時、YAMLファイルが存在しない場合は初期データが自動生成されます
- BGGから未知のメカニクス/カテゴリ/ランキング種別が見つかると、デフォルト値で自動追加されます
- 自動追加されたアイテムは、適切な複雑さ値に手動で更新することをお勧めします

#### カスタマイズの方法

1. YAMLファイルをテキストエディタで開きます（必ずUTF-8対応エディタを使用）
2. 複雑さの値を実際のゲーム体験に基づいて調整します
3. 変更を保存し、アプリを再起動します

複雑さデータをカスタマイズすることで、分析結果がより正確になり、自分の感覚により近い評価が得られるようになります。

### 戦略的価値と相互作用の分析

最新バージョンでは、メカニクスとカテゴリごとに戦略的価値と相互作用の値を定義し、より詳細な分析が可能になりました。これらの値はmechanic_strategic_values.yamlとcategory_strategic_values.yamlファイルで管理され、以下のような情報を含んでいます：

### 戦略的価値（Strategic Value）

- メカニクスやカテゴリが持つ戦略的深さを表す値（1.0～5.0）
- 例：Engine Building（5.0）、Worker Placement（5.0）、Deck Building（5.0）など

### 相互作用値（Interaction Value）

- プレイヤー間の相互作用の程度を表す値（1.0～5.0）
- 例：Trading（5.0）、Negotiation（5.0）、Auction/Bidding（5.0）など

これらの値は、ゲームの戦略深度と相互作用の複雑さをより精密に計算するために使用されます。

### 分析アルゴリズムの改良点

最新版では、以下の分析アルゴリズムの改良が行われています：

**戦略深度計算の精緻化：**

- 上位メカニクスの重み付けを調整し、多様なメカニクスの組み合わせをより適切に評価
- プレイ時間に基づく戦略的深さの調整（長時間ゲームの戦略性を適切に評価）

**相互作用複雑性の計算改善：**

- カテゴリとメカニクスの重み付けバランスを最適化（60:40）
- プレイヤー数に基づく修正係数の調整

**リプレイ性評価の向上：**

- ランキング情報と発行年に基づく長期的人気の考慮
- 特定のリプレイ性を高めるメカニクスへの重み付け調整

## ファイル構成

- app.py - メインアプリケーション（Streamlit UI）
- bgg_api.py - BoardGameGeek APIとの通信を行う関数
- data_handler.py - データ保存・変換を扱う関数
- learning_curve.py - 学習曲線分析のロジック
- mechanic_complexity.py - メカニクスの複雑さ評価を扱う関数
- category_complexity.py - カテゴリの複雑さ評価を扱う関数
- rank_complexity.py - ランキング種別の複雑さ評価を扱う関数
- strategic_depth.py - 戦略深度計算の改善機能
- ui_components.py - UIコンポーネント関数
- rate_limiter.py - API呼び出しのレート制限と再試行機能
- mechanics_data.yaml - メカニクスの複雑さデータ
- categories_data.yaml - カテゴリの複雑さデータ
- rank_complexity.yaml - ランキング種別の複雑さデータ
- mechanic_strategic_values.yaml - メカニクスの戦略的価値データ
- category_strategic_values.yaml - カテゴリの戦略的価値データ
- requirements.txt - 必要なパッケージのリスト

## API制限と最適化

- BGG APIへのリクエストはレート制限され、キャッシュされます
- リクエスト間の待機時間を自動調整して429エラーを回避
- データはTTL（Time To Live）キャッシュでローカルに保存され、効率的なAPI利用を実現
- エラー発生時の自動再試行機能により信頼性を向上

## 注意事項

- BoardGameGeek APIの使用には制限があり、短時間に多数のリクエストを送ると一時的にブロックされる場合があります
- 初回起動時に各YAMLファイルが存在しない場合は自動的に初期データが作成されます
- ゲーム名に特殊文字（:;など）が含まれていると、ファイル保存に失敗する場合があります
- このツールは学習曲線分析アルゴリズムが主観的要素を含み、絶対的な評価ではありません

## ライセンス

このプロジェクトはオープンソースであり、自由に使用・改変できます。

## 謝辞

このアプリケーションはBoardGameGeek APIを使用しています。BoardGameGeekに感謝します。
